# 年发文量趋势分析问题诊断指南

## 问题描述
用户在上传图片进行年发文量趋势分析时，一直显示"正在分析"但没有结果。

## 可能的原因和解决方案

### 1. API配置问题

**症状**: 控制台显示"API_CONFIG 未定义"或"请在config.js中配置API密钥"

**解决方案**:
1. 打开浏览器开发者工具 (F12)
2. 查看控制台是否有错误信息
3. 检查 `config.js` 文件是否正确加载
4. 确认API密钥是否已配置

**检查步骤**:
```javascript
// 在浏览器控制台中运行以下命令
console.log('API_CONFIG:', typeof API_CONFIG);
console.log('API_KEYS:', API_KEYS);
console.log('CURRENT_CONFIG:', CURRENT_CONFIG);
```

### 2. 模块映射问题

**症状**: 控制台显示"未找到模块的专用prompt"

**解决方案**:
1. 检查模块映射是否正确
2. 确认提示词文件是否正确加载

**检查步骤**:
```javascript
// 在浏览器控制台中运行以下命令
console.log('PROMPT_MAPPING:', PROMPT_MAPPING);
console.log('getModulePrompt:', typeof getModulePrompt);
console.log('getModuleNameFromDescriptor:', typeof getModuleNameFromDescriptor);
```

### 3. 脚本加载顺序问题

**症状**: 各种函数未定义错误

**解决方案**:
1. 确保 `config.js` 在 `ai-core.js` 之前加载
2. 确保 `prompts/index.js` 在所有提示词文件之后加载

### 4. 网络连接问题

**症状**: API调用超时或网络错误

**解决方案**:
1. 检查网络连接
2. 确认API服务是否可用
3. 检查防火墙设置

## 诊断工具

### 使用快速测试页面
1. 打开 `quick-test.html`
2. 点击各个测试按钮
3. 查看测试结果，识别问题所在

### 使用调试工具
1. 打开 `debug-temporal-evolution.html`
2. 运行完整诊断
3. 根据诊断结果修复问题

## 常见错误和解决方案

### 错误1: "API_CONFIG 未定义"
**原因**: `config.js` 文件未正确加载
**解决**: 检查HTML文件中的脚本加载顺序

### 错误2: "请在config.js中配置API密钥"
**原因**: API密钥未配置或配置错误
**解决**: 在 `config.js` 中配置正确的API密钥

### 错误3: "未找到模块的专用prompt"
**原因**: 模块映射错误或提示词文件未加载
**解决**: 检查模块映射和提示词文件

### 错误4: "字段映射错误"
**原因**: 提示词输出的字段名与HTML表单字段ID不匹配
**解决**: 检查字段映射配置

## 修复后的验证

修复完成后，请按以下步骤验证：

1. **基础检查**:
   - 打开 `quick-test.html`
   - 运行"基础配置检查"
   - 确保所有检查都通过

2. **功能测试**:
   - 在主页面中上传年发文量趋势图片
   - 观察是否能正常分析并填充数据
   - 检查控制台是否有错误信息

3. **数据验证**:
   - 确认所有14个字段都能正确填充
   - 验证数据格式是否正确

## 联系支持

如果问题仍然存在，请提供以下信息：
1. 浏览器控制台的错误信息
2. 使用的浏览器版本
3. 操作系统版本
4. 问题发生的具体步骤

## 技术细节

- **提示词**: `PUBLICATION_EVOLUTION_PROMPT`
- **模块名称**: `temporal-evolution`
- **字段数量**: 14个字段
- **数据格式**: JSON格式，字段名与HTML表单字段ID匹配
