<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>瀑布流布局修复测试</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .test-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            margin-bottom: 20px;
        }
        
        .test-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .status-info {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        
        .status-info h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .status-item {
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        
        .status-item:last-child {
            border-bottom: none;
        }
        
        .status-label {
            font-weight: bold;
            color: #555;
        }
        
        .status-value {
            color: #28a745;
            font-weight: 600;
        }
        
        .error {
            color: #dc3545;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="test-header">
            <h1>🔧 瀑布流布局修复测试</h1>
            <p>验证模块显示和搜索功能</p>
        </div>
        
        <div class="status-info">
            <h3>📊 系统状态</h3>
            <div class="status-item">
                <span class="status-label">页面加载时间:</span>
                <span class="status-value" id="loadTime">计算中...</span>
            </div>
            <div class="status-item">
                <span class="status-label">模块总数:</span>
                <span class="status-value" id="moduleCount">计算中...</span>
            </div>
            <div class="status-item">
                <span class="status-label">可见模块数:</span>
                <span class="status-value" id="visibleCount">计算中...</span>
            </div>
            <div class="status-item">
                <span class="status-label">瀑布流状态:</span>
                <span class="status-value" id="waterfallStatus">正常</span>
            </div>
            <div class="status-item">
                <span class="status-label">布局类型:</span>
                <span class="status-value" id="layoutType">检测中...</span>
            </div>
        </div>
        
        <div class="form-container" id="testContainer">
            <!-- 测试模块 -->
            <div class="section">
                <h3><span class="section-icon">1</span>数据检索基础信息</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>数据库来源</label>
                        <input type="text" placeholder="测试输入">
                    </div>
                    <div class="form-group">
                        <label>检索策略</label>
                        <textarea placeholder="测试文本区域"></textarea>
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3><span class="section-icon">2</span>年发文量趋势分析</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>起步期</label>
                        <input type="text" placeholder="2010-2015">
                    </div>
                    <div class="form-group">
                        <label>成长期</label>
                        <input type="text" placeholder="2016-2020">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3><span class="section-icon">3</span>国家/地区分布</h3>
                <div class="stats-row">
                    <div class="stats-item">
                        <div class="stats-label">参与国家总数</div>
                        <input type="number" class="stats-input" placeholder="0">
                    </div>
                    <div class="stats-item">
                        <div class="stats-label">国际合作文献</div>
                        <input type="number" class="stats-input" placeholder="0">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3><span class="section-icon">4</span>期刊分布</h3>
                <div class="ranking-group">
                    <div class="ranking-title">📚 期刊排名</div>
                    <div class="ranking-item">
                        <div class="rank-number">1</div>
                        <input type="text" placeholder="期刊名称">
                        <input type="number" placeholder="0">
                        <input type="number" step="0.01" placeholder="0.00">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3><span class="section-icon">5</span>机构分布</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>机构总数</label>
                        <input type="number" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>高产机构</label>
                        <input type="number" placeholder="0">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <h3><span class="section-icon">6</span>作者分析</h3>
                <div class="form-grid">
                    <div class="form-group">
                        <label>作者总数</label>
                        <input type="number" placeholder="0">
                    </div>
                    <div class="form-group">
                        <label>高产作者</label>
                        <input type="number" placeholder="0">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 页面加载时间计算
        const startTime = performance.now();
        
        // 状态更新函数
        function updateStatus() {
            const loadTime = ((performance.now() - startTime) / 1000).toFixed(2);
            document.getElementById('loadTime').textContent = loadTime + '秒';
            
            const sections = document.querySelectorAll('.section');
            document.getElementById('moduleCount').textContent = sections.length;
            
            const visibleSections = Array.from(sections).filter(section => 
                section.style.display !== 'none' && section.offsetParent !== null
            );
            document.getElementById('visibleCount').textContent = visibleSections.length;
            
            const container = document.getElementById('testContainer');
            const computedStyle = window.getComputedStyle(container);
            document.getElementById('layoutType').textContent = computedStyle.display;
            
            // 检查瀑布流布局状态
            const container = document.getElementById('testContainer');
            const computedStyle = window.getComputedStyle(container);
            if (computedStyle.display === 'grid') {
                document.getElementById('waterfallStatus').textContent = '正常';
                document.getElementById('waterfallStatus').className = 'status-value';
            } else {
                document.getElementById('waterfallStatus').textContent = '异常';
                document.getElementById('waterfallStatus').className = 'error';
            }
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('页面加载完成');
            updateStatus();
            
            // 每秒更新一次状态
            setInterval(updateStatus, 1000);
            
            // 监听模块显示状态变化
            const observer = new MutationObserver(function(mutations) {
                mutations.forEach(function(mutation) {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'style') {
                        updateStatus();
                    }
                });
            });
            
            const sections = document.querySelectorAll('.section');
            sections.forEach(section => {
                observer.observe(section, {
                    attributes: true,
                    attributeFilter: ['style']
                });
            });
        });
        
        // 监听窗口大小变化
        window.addEventListener('resize', function() {
            setTimeout(updateStatus, 100);
        });
    </script>
</body>
</html>
