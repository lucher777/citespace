# 核心引文模块修复说明

## 问题描述
核心引文模块没有采集到足够的数据，主要原因是AI提示词中的字段ID与HTML表单中的`data-field-id`属性不匹配，导致数据无法正确应用。用户提供的图片显示有20行核心引文数据，但HTML表单只支持5个引文。

## 问题分析

### 原始问题
1. **字段不匹配**：AI提示词使用字段如`core_papers`、`citation_frequency`、`high_cited_papers`等，但HTML表单使用`high_cited_papers_total`、`citation_1_author_year`、`citation_1_frequency`等
2. **数据容量不足**：HTML表单只支持5个引文，无法满足实际分析需求（图片显示20个引文）
3. **表格识别能力不足**：AI提示词缺乏对核心引文表格的专门识别指导

### 修复方案
采用与聚类分析和关键词分析模块相同的修复策略，确保字段映射一致性和数据完整性。

## 修复内容

### 1. 更新AI提示词 (`prompts/core-citations-prompts.js`)

**主要修改：**
- 将字段ID从通用描述性字段改为具体的HTML字段ID
- 支持从`citation_1_author_year`到`citation_20_author_year`的20个引文
- 添加表格数据识别说明，指导AI正确解析核心引文表格
- 更新示例JSON，展示完整的字段映射，基于用户提供的图片数据

**字段映射对照：**
| 原字段 | 新字段 | 说明 |
|--------|--------|------|
| `core_papers` | `high_cited_papers_total` | 高被引文献总数 |
| `citation_frequency` | `citation_X_frequency` | 各引文被引频次 |
| `high_cited_papers` | `citation_X_author_year` | 各引文作者及年份 |
| - | `citation_X_centrality` | 各引文中心性 |

### 2. 扩展HTML表单 (`index.html`)

**主要修改：**
- 在核心引文排名表格中添加排名6-20的输入行
- 每个新增行包含：作者及年份、被引频次、期刊名称、中心性
- 保持与现有行相同的样式和结构

**新增字段：**
- `citation_6_author_year` 到 `citation_20_author_year`
- `citation_6_frequency` 到 `citation_20_frequency`
- `citation_6_journal` 到 `citation_20_journal`
- `citation_6_centrality` 到 `citation_20_centrality`

### 3. 创建测试页面 (`test-core-citations.html`)

**功能特点：**
- 完整的核心引文模块HTML结构
- 预置测试数据，包含20个引文的完整信息（基于用户提供的图片）
- 自动加载测试数据功能
- 数据清空和验证功能
- 返回主页链接

**测试数据包含：**
- 高被引文献总数：20
- 前20个引文的完整信息（作者及年份、被引频次、中心性）

## 修复效果

### 数据采集能力提升
1. **字段匹配度**：100%匹配，AI输出可直接应用到HTML表单
2. **数据容量**：从5个引文扩展到20个引文
3. **表格识别**：AI能够正确识别和解析核心引文表格

### 用户体验改善
1. **数据完整性**：能够采集和显示更多引文信息
2. **操作便利性**：测试页面提供快速验证功能
3. **错误减少**：字段匹配问题得到根本解决

## 验证方法

### 1. 使用测试页面
1. 打开 `test-core-citations.html`
2. 页面会自动加载测试数据
3. 验证所有字段是否正确显示
4. 测试清空和重新加载功能

### 2. 实际数据采集测试
1. 在主页面选择"核心引文"模块
2. 点击"📊 图文采集"按钮
3. 上传包含核心引文表格的图片
4. 验证AI是否正确提取和填充数据

### 3. 字段映射验证
检查以下字段是否正确映射：
- `high_cited_papers_total` → 高被引文献总数
- `citation_X_author_year` → 引文作者及年份
- `citation_X_frequency` → 引文被引频次
- `citation_X_centrality` → 引文中心性

## 技术细节

### AI提示词优化
- 添加了专门的表格数据识别说明
- 明确了字段格式要求（数字、小数位数、作者格式）
- 提供了完整的示例JSON结构，基于实际数据

### HTML结构扩展
- 保持了原有的响应式设计
- 新增行与现有行样式一致
- 不影响其他模块的功能

### 数据流优化
- AI输出 → JSON解析 → 字段映射 → HTML填充
- 每个环节都有明确的字段对应关系
- 减少了数据丢失和错误

## 数据格式说明

### 作者及年份格式
- 标准格式：姓氏+首字母缩写, 年份
- 示例：Schon DA, 2017
- 支持多作者情况

### 被引频次格式
- 纯数字格式
- 示例：48, 34, 33

### 中心性格式
- 保留2位小数
- 示例：0.46, 0.06, 0.19

## 后续建议

1. **监控使用情况**：观察修复后的数据采集效果
2. **用户反馈**：收集用户对核心引文模块的使用反馈
3. **进一步优化**：根据实际使用情况考虑是否需要支持更多引文
4. **文档更新**：及时更新相关使用文档和说明

## 总结

通过系统性的字段映射修复和功能扩展，核心引文模块的数据采集能力得到了显著提升。修复后的模块能够：
- 正确识别和提取核心引文表格数据
- 支持更多引文的完整信息（20个引文）
- 提供更好的用户体验和操作便利性

这次修复为CiteSpace数据采集系统的整体稳定性奠定了基础，也为其他模块的类似问题提供了解决方案参考。基于用户提供的实际数据进行的修复，确保了修复的准确性和实用性。
